<p-dialog
  header="Ajouter une règle"
  [(visible)]="visible"
  (onHide)="closeDialog()"
  [style]="{ width: '25rem' }"
>
    <form
      [formGroup]="ruleForm"
      (ngSubmit)="createRule()"
      class="flex flex-column gap-3"
    >
      <input
        pInputText
        placeholder="Nom de la règle"
        formControlName="name"
        style="width: 100%"
      />
      @if (
        ruleForm.controls.name.invalid && ruleForm.controls.name.touched
      ) {
        @if (ruleForm.controls.name.hasError("required")) {
          <p-message severity="error" size="small" variant="simple"
            >Nom obligatoire</p-message
          >
        }

        @if (ruleForm.controls.name.hasError("minlength")) {
          <p-message severity="error" size="small" variant="simple"
            >Minimum 3 lettres</p-message
          >
        }
      }
      @if (policies$ | async; as policies) {
        <p-autoComplete
          formControlName="policy_id"
          [suggestions]="filteredPolicies"
          (completeMethod)="filterPolicies($event, policies)"
          [dropdown]="true"
          placeholder="Rechercher une politique"
          [inputStyle]="{ width: '100%' }"
          optionLabel="name"
          optionValue="id"
          [appendTo]="'body'"
          style="width: 100%"
        >
        </p-autoComplete>
      }

      <div class="flex justify-content-end gap-2 mt-2">
        <p-button
          label="Annuler"
          severity="secondary"
          (click)="closeDialog()"
        />
        <button pButton type="submit" [disabled]="ruleForm.invalid">Créer</button>
      </div>
    </form>
</p-dialog>
