<p-dialog
  header="Ajouter une règle"
  [(visible)]="visible"
  (onHide)="closeDialog()"
  [style]="{ width: '25rem' }"
>
  <form
    [formGroup]="ruleForm"
    (ngSubmit)="createRule()"
    class="flex flex-column gap-3"
  >
    <input
      pInputText
      placeholder="Nom de la règle"
      formControlName="name"
      style="width: 100%"
    />
    @if (
      ruleForm.controls.name.invalid &&
      (ruleForm.controls.name.touched || ruleForm.controls.name.dirty)
    ) {
      @if (ruleForm.controls.name.hasError("required")) {
        <small class="text-red-500">Le nom est obligatoire</small>
      }

      @if (ruleForm.controls.name.hasError("minlength")) {
        <small class="text-red-500">Minimum 3 lettres</small>
      }
    }
    @if (policies$ | async; as policies) {
      <p-autoComplete
        formControlName="policy_id"
        [suggestions]="filteredPolicies"
        (completeMethod)="filterPolicies($event, policies)"
        [dropdown]="true"
        placeholder="Rechercher une politique"
        [inputStyle]="{ width: '100%' }"
        optionLabel="name"
        optionValue="id"
        [appendTo]="'body'"
        style="width: 100%"
      >
      </p-autoComplete>
    }

    <div class="flex justify-content-end gap-2 mt-2">
      <p-button label="Annuler" severity="secondary" (click)="closeDialog()" />
      <button pButton type="submit" [disabled]="ruleForm.invalid">Créer</button>
    </div>
  </form>
</p-dialog>
